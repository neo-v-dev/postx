# Phase 1 基盤構築 - リスク評価

**作成日時**: 2026-01-31 23:49:01 PST
**フェーズ**: Phase 1 - 基盤構築
**評価者**: Orchestrator

## リスク概要

Phase 1は基盤構築（ディレクトリ・ファイル作成）のため、実装リスクは低いです。ただし、構造設計の誤りは後続フェーズに大きな影響を与えるため、設計レビューが重要です。

## 識別されたリスク

### R-P1-001: ディレクトリ構造の不適切さ

**リスク内容**: Pythonパッケージ構造が標準的でない、または拡張性に欠ける構造を採用する

**発生確率**: 低
**影響度**: 高（後続フェーズでの大規模リファクタリングが必要）

**対策**:
- Python公式パッケージングガイドに準拠
- レイヤードアーキテクチャ（services/utils分離）を採用
- 既存のPythonプロジェクト構造ベストプラクティスを参照

**検出方法**:
- 構造レビュー
- 類似プロジェクトとの比較

### R-P1-002: 依存関係のバージョン競合

**リスク内容**: requirements.txtで指定したパッケージ間でバージョン競合が発生する

**発生確率**: 低
**影響度**: 中（依存関係解決に時間を要する）

**対策**:
- 最小バージョン指定（>=）を使用
- 広く採用されている安定版を選択
- pip install --dry-runで事前検証

**検出方法**:
```bash
pip install --dry-run -r scheduler/requirements.txt
```

### R-P1-003: JSON初期データの設計ミス

**リスク内容**: data/posts.jsonの初期構造が要件を満たさない、または拡張性に欠ける

**発生確率**: 中
**影響度**: 中（データ移行が必要）

**対策**:
- Phase 2のデータモデル設計と整合性を保つ
- スキーマ拡張を考慮した柔軟な構造
- 必須フィールドとオプショナルフィールドの明確化

**検出方法**:
- データモデル設計書とのクロスチェック
- JSON Schemaによる検証（Phase 2実装時）

### R-P1-004: .gitignoreの漏れ

**リスク内容**: 機密情報や不要ファイルがGitにコミットされる

**発生確率**: 中
**影響度**: 高（機密情報漏洩の可能性）

**対策**:
- Python標準の.gitignoreテンプレート使用
- .env*, *.pemなど機密ファイルパターンを明示的に除外
- data/posts.jsonは含めるが、将来的に.env分離を検討

**検出方法**:
```bash
git status --ignored
```

### R-P1-005: Pythonバージョン互換性

**リスク内容**: Python 3.11未満の環境で動作しない

**発生確率**: 低
**影響度**: 低（pyproject.tomlで要件明示）

**対策**:
- pyproject.tomlに`requires-python = ">=3.11"`を明記
- 3.11以降の機能（Tomllib等）を活用予定

**検出方法**:
```bash
python3 --version
```

### R-P1-006: ファイルパス区切り文字の差異

**リスク内容**: Windows/Unix環境でパス区切り文字が異なり動作しない

**発生確率**: 低
**影響度**: 低（現在はmacOS環境のみ）

**対策**:
- pathlibモジュールを使用（OS非依存）
- ハードコードされたパス区切り文字を避ける

**検出方法**:
- コードレビューでパス操作をチェック

## リスクマトリクス

| リスクID | リスク内容 | 確率 | 影響度 | リスクレベル | 優先度 |
|---------|----------|------|-------|------------|--------|
| R-P1-001 | ディレクトリ構造不適切 | 低 | 高 | 中 | High |
| R-P1-002 | 依存関係バージョン競合 | 低 | 中 | 低 | Medium |
| R-P1-003 | JSON初期データ設計ミス | 中 | 中 | 中 | High |
| R-P1-004 | .gitignore漏れ | 中 | 高 | 高 | High |
| R-P1-005 | Pythonバージョン互換性 | 低 | 低 | 低 | Low |
| R-P1-006 | ファイルパス区切り文字差異 | 低 | 低 | 低 | Low |

## 事前チェックリスト

実装開始前に以下を確認:

- [ ] Python 3.11以上がインストールされているか
- [ ] 作業ディレクトリ `/Users/neo/workspace/stream/repo/X-doc` が存在するか
- [ ] 既存のscheduler/ディレクトリが存在しないか（クリーンな状態か）
- [ ] Git履歴を確認し、誤って削除したファイルがないか
- [ ] Phase 2のデータモデル設計書を参照したか
- [ ] Python標準パッケージ構造を確認したか

## 実装中モニタリング

- ファイル作成時にパーミッション確認
- JSON構文の即時検証
- Python構文エラーの即時検出

## 実装後検証

```bash
# 1. ディレクトリ存在確認
test -d scheduler && test -d data && test -d media && echo "OK"

# 2. Pythonパッケージインポート確認
python3 -c "import scheduler; print('OK')"

# 3. JSON妥当性確認
python3 -c "import json; json.load(open('data/posts.json')); print('OK')"

# 4. 依存関係解決確認
pip install --dry-run -r scheduler/requirements.txt

# 5. Git除外設定確認
git status --ignored
```

## ロールバック手順

Phase 1でエラーが発生した場合:

```bash
# 作成したファイル・ディレクトリを削除
rm -rf scheduler/ data/ media/
rm pyproject.toml .gitignore

# Gitの変更を破棄（コミット前の場合）
git checkout .
```

## 次フェーズへの影響

### 成功時
- Phase 2（データモデル実装）へスムーズに移行
- 標準的な構造により開発者オンボーディングが容易

### 失敗時
- 構造の再設計が必要
- 後続フェーズの遅延（最大1日）

## 承認基準

以下がすべて満たされた場合、Phase 1完了とみなす:

1. すべてのディレクトリ・ファイルが作成されている
2. Pythonパッケージとしてインポート可能
3. data/posts.jsonが有効なJSON形式
4. すべての.pyファイルにmodule docstringが存在
5. 依存関係が解決可能（pip install成功）
6. .gitignoreが適切に設定されている

## 残存リスク

Phase 1完了後も以下のリスクが残存:

- **データスキーマ変更リスク**: Phase 2実装時にdata/posts.jsonの構造変更が必要になる可能性（中程度）
  - 対策: マイグレーションスクリプトの準備を検討

- **依存関係の脆弱性リスク**: 使用するライブラリに脆弱性が発見される可能性（低程度）
  - 対策: 定期的な`pip audit`実行を推奨

## レビュー推奨事項

Phase 1完了後、以下のレビューを推奨:

1. **構造レビュー**: Pythonパッケージ構造の適切性
2. **セキュリティレビュー**: .gitignoreの網羅性
3. **設計レビュー**: data/posts.json初期構造の妥当性

レビューパターン: Quick（claude-reviewer + security-reviewer）
