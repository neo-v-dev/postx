# GitHub API クライアント実装 - 技術選定理由

**作成日時**: 2026-02-01 00:43:16 PST

## 1. 採用技術一覧

| カテゴリ | 技術 | バージョン | 選定理由 |
|---------|------|-----------|---------|
| **GitHub APIクライアント** | @octokit/rest | ^20.0.0 | 公式SDK、型定義完備、安定性高 |
| **認証** | next-auth | ^4.24.0 | Next.js標準、GitHub OAuth対応 |
| **言語** | TypeScript | ^5.3.0 | 型安全性、開発体験向上 |
| **ランタイム** | Next.js | ^14.2.0 | 既存プロジェクト準拠 |

## 2. GitHub APIクライアント選定

### 比較検討

| ライブラリ | メリット | デメリット | 評価 |
|-----------|---------|-----------|------|
| **@octokit/rest** | ✅ GitHub公式<br>✅ TypeScript型定義完備<br>✅ 活発な開発<br>✅ レート制限情報取得可能 | - サイズが大きい（約100KB） | ⭐⭐⭐⭐⭐ |
| **octokit** (統合版) | ✅ プラグイン対応<br>✅ より高機能 | ❌ オーバースペック<br>❌ サイズが非常に大きい | ⭐⭐⭐ |
| **fetch直接** | ✅ 軽量<br>✅ 依存なし | ❌ 型定義なし<br>❌ 認証実装が必要<br>❌ エラーハンドリング複雑 | ⭐⭐ |
| **axios + 手動実装** | ✅ HTTPクライアントとして汎用 | ❌ GitHub API仕様を手動実装<br>❌ メンテナンス負荷 | ⭐⭐ |

### 選定理由: @octokit/rest

1. **型安全性**
   - 全API操作にTypeScript型定義
   - コンパイル時にエラー検出
   ```typescript
   // ✅ Type-safe
   const { data } = await octokit.repos.getContent({
     owner: 'user',
     repo: 'repo',
     path: 'posts.json',
   });
   ```

2. **GitHub公式サポート**
   - APIバージョンアップに追随
   - セキュリティパッチの迅速提供
   - ベストプラクティスの反映

3. **エラーハンドリング**
   - レート制限情報の自動取得
   - HTTPステータスコードの統一的な処理
   - リトライロジックのプラグイン対応

4. **既存導入済み**
   - `package.json`に既に含まれている
   - 追加のバンドルサイズ増加なし

## 3. 認証方式選定

### 比較検討

| 方式 | メリット | デメリット | 評価 |
|------|---------|-----------|------|
| **next-auth (OAuth)** | ✅ 既存実装済み<br>✅ トークン自動リフレッシュ<br>✅ セキュア | - 初回セットアップ複雑 | ⭐⭐⭐⭐⭐ |
| **Personal Access Token** | ✅ シンプル | ❌ ユーザー毎に発行必要<br>❌ 有効期限管理が手動 | ⭐⭐ |
| **GitHub App** | ✅ 組織利用に適する | ❌ 個人利用にはオーバースペック<br>❌ セットアップ複雑 | ⭐⭐ |

### 選定理由: next-auth (OAuth)

1. **既存インフラ活用**
   - プロジェクトに既に導入済み（`package.json`）
   - 追加の認証実装不要

2. **セキュリティ**
   - トークンをブラウザに保存しない（セッションCookie）
   - 自動リフレッシュでトークン期限切れを防止
   - CSRF保護組み込み

3. **ユーザー体験**
   - GitHubアカウントでワンクリックログイン
   - トークン管理をユーザーが意識しない

## 4. データ永続化方式選定

### 比較検討

| 方式 | メリット | デメリット | 評価 |
|------|---------|-----------|------|
| **GitHub (JSON)** | ✅ バックアップ不要<br>✅ バージョン履歴<br>✅ 無料<br>✅ API対応 | - 大量アクセスに弱い<br>- レート制限あり | ⭐⭐⭐⭐⭐ |
| **データベース (Supabase等)** | ✅ 高速<br>✅ クエリ機能豊富 | ❌ コスト発生<br>❌ インフラ管理必要 | ⭐⭐⭐ |
| **ローカルファイル** | ✅ 高速<br>✅ シンプル | ❌ バックアップ必要<br>❌ 複数デバイス同期不可 | ⭐⭐ |
| **KVストア (Vercel KV等)** | ✅ 高速<br>✅ シンプルAPI | ❌ コスト発生<br>❌ バージョン履歴なし | ⭐⭐⭐ |

### 選定理由: GitHub (JSON)

1. **要件適合**
   - 投稿スケジューラーはリアルタイム性不要
   - データ量は中小規模（数百〜数千投稿）
   - 読み取り > 書き込み

2. **コスト**
   - 完全無料（GitHub無料プラン範囲内）
   - インフラ管理不要

3. **信頼性**
   - GitHubの99.9%稼働率
   - 自動バックアップ（コミット履歴）
   - ロールバック可能

4. **開発体験**
   - GitHubブラウザUIで直接編集可能
   - 変更履歴が自動追跡
   - CI/CDとの統合容易

### レート制限対策

```typescript
// 想定利用パターン
const operations = {
  getPosts: '1回/ページ読み込み',
  createPost: '数回/日',
  updatePost: '数回/日',
  deletePost: '数回/日',
};

// 月間推定リクエスト数
const monthly = {
  getPosts: 30 * 10, // 300リクエスト/月
  writes: 10, // 10リクエスト/月
  total: 310, // << 5,000リクエスト/時間
};
```

## 5. ID生成方式選定

### 比較検討

| 方式 | メリット | デメリット | 評価 |
|------|---------|-----------|------|
| **UUID v4** | ✅ 衝突確率ほぼゼロ<br>✅ ライブラリ不要 | - 長い（36文字） | ⭐⭐⭐⭐⭐ |
| **ULID** | ✅ ソート可能<br>✅ タイムスタンプ含む | - ライブラリ必要 | ⭐⭐⭐⭐ |
| **連番** | ✅ 短い<br>✅ 人間に優しい | ❌ 競合リスク高<br>❌ 予測可能 | ⭐⭐ |
| **nanoid** | ✅ 短い（21文字）<br>✅ URL安全 | - ライブラリ必要 | ⭐⭐⭐⭐ |

### 選定理由: UUID v4

1. **標準ライブラリ**
   ```typescript
   // Node.js 14.17.0以降、標準APIで生成可能
   import { randomUUID } from 'crypto';
   const id = randomUUID(); // "3d6f9e8c-..."
   ```

2. **衝突リスクほぼゼロ**
   - 2^122の名前空間
   - 同時書き込み時も安全

3. **追加依存なし**
   - バンドルサイズ増加なし
   - メンテナンス負荷なし

## 6. 日付処理ライブラリ選定

### 既存採用: date-fns & date-fns-tz

```json
{
  "dependencies": {
    "date-fns": "^3.0.0",
    "date-fns-tz": "^2.0.0"
  }
}
```

### 選定理由

1. **既存導入済み**
   - 追加のバンドルサイズなし

2. **タイムゾーン対応**
   - `date-fns-tz`で`Asia/Tokyo`等の処理可能
   ```typescript
   import { formatInTimeZone } from 'date-fns-tz';
   const timestamp = formatInTimeZone(
     new Date(),
     'Asia/Tokyo',
     "yyyy-MM-dd'T'HH:mm:ssXXX"
   );
   ```

3. **Tree-shakable**
   - 使用する関数のみバンドル
   - moment.jsと比較して軽量

## 7. エラーハンドリング戦略

### カスタムエラークラス vs エラーコード

| 方式 | メリット | デメリット | 選定 |
|------|---------|-----------|------|
| **カスタムエラークラス** | ✅ 型安全<br>✅ スタックトレース | - クラス定義が必要 | ⭐⭐⭐⭐⭐ |
| **エラーコード文字列** | ✅ シンプル | ❌ 型安全性なし | ⭐⭐ |

### 選定理由: カスタムエラークラス

```typescript
// Type-safe error handling
try {
  await postsAPI.updatePost(id, updates);
} catch (error) {
  if (error instanceof GitHubConflictError) {
    // Retry logic
  } else if (error instanceof GitHubRateLimitError) {
    // Show rate limit message
  }
}
```

## 8. 却下した代替案

### 8.1 GraphQL API (GitHub GraphQL v4)

**却下理由:**
- ファイル更新はREST APIが必須（GraphQLは読み取りのみ）
- 複雑さが不要（RESTで十分）

### 8.2 Git直接操作（nodegit等）

**却下理由:**
- ブラウザ環境で動作不可
- サーバーサイド専用のため、Next.jsのAPI Routesでのみ使用可能
- GitHub APIより複雑

### 8.3 Firebase / Firestore

**却下理由:**
- 月額コスト発生
- Google Cloud依存
- GitHubとの統合が複雑

## 9. 技術リスク評価

| 技術 | リスク | 軽減策 | 残存リスク |
|------|-------|-------|-----------|
| @octokit/rest | APIバージョン変更 | セマンティックバージョニング遵守 | 低 |
| GitHub API | レート制限 | キャッシュ、リクエスト最適化 | 中 |
| next-auth | トークン期限切れ | 自動リフレッシュ機能 | 低 |
| JSON保存 | ファイル破損 | バリデーション、Git履歴 | 低 |

## 10. 結論

選定した技術スタックは以下の理由で最適:

1. **既存プロジェクトとの統合**: すべて`package.json`に含まれており、追加依存なし
2. **型安全性**: TypeScript + @octokit/restの組み合わせで完全な型安全性
3. **コスト**: 完全無料（GitHub無料プラン範囲内）
4. **保守性**: 公式ライブラリのみ使用、長期サポート保証
5. **セキュリティ**: next-auth + GitHubの組み合わせでエンタープライズレベル

追加ライブラリの導入は不要であり、既存の技術スタックで完全に実装可能。
